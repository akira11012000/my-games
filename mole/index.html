<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚‚ãã‚‰ãŸãŸãã‚²ãƒ¼ãƒ ï¼ˆæ”¹è‰¯ç‰ˆï¼‰</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #22c55e, #022c22);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #022c22;
    }

    .game-wrapper {
      background: #f9fafb;
      border-radius: 18px;
      padding: 18px 18px 20px;
      width: 95%;
      max-width: 430px;
      box-shadow: 0 16px 40px rgba(15,23,42,0.6);
    }

    h1 {
      margin: 0 0 6px;
      text-align: center;
      font-size: 1.5rem;
      color: #111827;
    }

    .subtitle {
      text-align: center;
      font-size: 0.85rem;
      color: #6b7280;
      margin-bottom: 10px;
      line-height: 1.4;
    }

    .top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    .info-box {
      padding: 6px 10px;
      border-radius: 999px;
      background: #ecfdf5;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      color: #047857;
      font-weight: 600;
    }

    .difficulty-box {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.8rem;
    }
    .difficulty-box select {
      font-size: 0.8rem;
      padding: 3px 6px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #fff;
    }

    .buttons {
      display: flex;
      gap: 6px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 0.8rem;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.2s;
      white-space: nowrap;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    #startButton {
      background: #22c55e;
      color: #064e3b;
      box-shadow: 0 3px 10px rgba(34,197,94,0.4);
    }

    #resetButton {
      background: #e5e7eb;
      color: #374151;
    }

    #grid {
      margin-top: 8px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .hole {
      width: 100%;
      aspect-ratio: 1 / 1;
      background: #e5e7eb;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: rgba(0,0,0,0);
      box-shadow: inset 0 4px 0 rgba(148,163,184,0.6);
      position: relative;
      overflow: hidden;
    }

    .hole::before {
      content: "";
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 26%;
      background: #9ca3af;
      border-radius: 999px;
      opacity: 0.5;
    }

    .hole-content {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 80%;
      height: 80%;
    }

    /* é»’ã„å¤§ããªãƒ¢ã‚°ãƒ© */
    .mole-body {
      width: 90%;
      height: 70%;
      background: #111827;
      border-radius: 999px 999px 40px 40px;
      position: relative;
      box-shadow: 0 4px 0 rgba(15,23,42,0.6);
    }
    .mole-face {
      position: absolute;
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
      width: 70%;
      height: 55%;
      background: #fef3c7;
      border-radius: 999px;
    }
    .mole-eye {
      position: absolute;
      top: 30%;
      width: 10px;
      height: 10px;
      background: #111827;
      border-radius: 50%;
    }
    .mole-eye.left { left: 30%; }
    .mole-eye.right { right: 30%; }
    .mole-mouth {
      position: absolute;
      bottom: 25%;
      left: 50%;
      transform: translateX(-50%);
      width: 40%;
      height: 10px;
      border-bottom: 3px solid #f97316;
      border-radius: 0 0 999px 999px;
    }

    .dont-hit-img {
      width: 85%;
      height: 85%;
      object-fit: cover;
      border-radius: 50%;
      box-shadow: 0 4px 0 rgba(148,163,184,0.8);
    }

    #message {
      margin-top: 6px;
      text-align: center;
      min-height: 1.4em;
      font-size: 0.9rem;
      color: #111827;
    }

    .hint {
      text-align: center;
      margin-top: 4px;
      font-size: 0.75rem;
      color: #6b7280;
    }

    .bottom-info {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: #4b5563;
    }

    /* ---- ã“ã“ã‹ã‚‰ã‚¹ãƒãƒ›ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ ---- */
    @media (max-width: 600px) {
      body {
        align-items: stretch;          /* ä¸Šã‹ã‚‰ä¸‹ã¸ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        justify-content: flex-start;
      }
      .game-wrapper {
        width: 100vw;                  /* æ¨ªã„ã£ã±ã„ */
        height: 100vh;                 /* ç¸¦ã„ã£ã±ã„ */
        max-width: none;
        border-radius: 0;              /* ç”»é¢ã„ã£ã±ã„ã«ãƒ•ã‚£ãƒƒãƒˆ */
        box-shadow: none;
        padding: 14px 10px 16px;
        overflow-y: auto;              /* ã¯ã¿å‡ºã™å ´åˆã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
      }
      #grid {
        gap: 6px;
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <h1>ã‚‚ãã‚‰ãŸãŸã</h1>
    <div class="subtitle">
      ã‚‚ãã‚‰ã ã‘ã‚’ç´ æ—©ããŸãŸã“ã†ï¼<br>
      ãƒ¡ã‚¬ãƒã®ãŠã˜ã•ã‚“ã‚’ãŸãŸãã¨ -5 ã«ãªã‚Šã¾ã™ã€‚
    </div>

    <div class="top-row">
      <div class="info-box">
        â± <span id="timeLeft">30</span>sã€€
        ğŸ¯ ã‚¹ã‚³ã‚¢ï¼š<span id="score">0</span>
      </div>
      <div class="difficulty-box">
        é›£æ˜“åº¦ï¼š
        <select id="difficultySelect">
          <option value="easy">ã‹ã‚“ãŸã‚“</option>
          <option value="normal" selected>ãµã¤ã†</option>
          <option value="hard">ã‚€ãšã‹ã—ã„</option>
        </select>
      </div>
      <div class="buttons">
        <button id="startButton">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
        <button id="resetButton">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
    </div>

    <div id="grid"></div>

    <div class="bottom-info">
      <div>ğŸ”¥ ã‚³ãƒ³ãƒœï¼š<span id="combo">0</span></div>
      <div>âŒ ãƒŸã‚¹ï¼š<span id="miss">0</span></div>
    </div>

    <div id="message"></div>
    <div class="hint">
      PCï¼šã‚¯ãƒªãƒƒã‚¯ ï¼ ã‚¹ãƒãƒ›ï¼šã‚¿ãƒƒãƒ—ã€‚<br>
      ã‚‚ãã‚‰ä»¥å¤–ã‚’ãŸãŸãã¨ã‚³ãƒ³ãƒœãŒåˆ‡ã‚Œã¦ãƒŸã‚¹ãŒå¢—ãˆã¾ã™ã€‚
    </div>
  </div>

  <script>
    // ========= åŠ¹æœéŸ³ï¼ˆWeb Audio APIï¼‰ =========
    var audioCtx = null;

    function initAudio() {
      if (audioCtx) return;
      try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      } catch (e) {
        audioCtx = null;
      }
    }

    function ensureAudioRunning() {
      if (!audioCtx) return;
      if (audioCtx.state === "suspended") {
        audioCtx.resume();
      }
    }

    function playBeep(freq, duration, type, volume) {
      if (!audioCtx) return;
      ensureAudioRunning();

      var osc = audioCtx.createOscillator();
      var gain = audioCtx.createGain();

      osc.type = type || "square";
      osc.frequency.value = freq || 440;
      gain.gain.value = (typeof volume === "number") ? volume : 0.2;

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start();
      setTimeout(function () {
        osc.stop();
      }, duration || 150);
    }

    function playHitSound() {
      playBeep(880, 80, "square", 0.25);
    }
    function playMissSound() {
      playBeep(220, 120, "sawtooth", 0.22);
    }
    function playGameOverSound() {
      playBeep(440, 150, "triangle", 0.2);
      setTimeout(function () {
        playBeep(330, 200, "triangle", 0.18);
      }, 180);
    }
    // ã‚ãŒã­ãŠã˜ã•ã‚“ç”¨ã®å¤§ããªéŸ³
    function playPenaltySound() {
      playBeep(200, 180, "sawtooth", 0.6);
      setTimeout(function () {
        playBeep(120, 200, "square", 0.5);
      }, 120);
    }

    // ========= ã‚²ãƒ¼ãƒ è¨­å®š =========
    var GAME_TIME = 30; // ç§’

    var DIFFICULTIES = {
      easy:   { moleInterval: 900, badRate: 0.15 },
      normal: { moleInterval: 700, badRate: 0.25 },
      hard:   { moleInterval: 500, badRate: 0.35 }
    };

    var difficultySelect = document.getElementById("difficultySelect");
    var currentDifficulty = DIFFICULTIES["normal"];

    // ========= DOM =========
    var grid = document.getElementById("grid");
    var timeLeftSpan = document.getElementById("timeLeft");
    var scoreSpan = document.getElementById("score");
    var comboSpan = document.getElementById("combo");
    var missSpan = document.getElementById("miss");
    var message = document.getElementById("message");
    var startButton = document.getElementById("startButton");
    var resetButton = document.getElementById("resetButton");

    // ========= çŠ¶æ…‹ =========
    var holes = [];
    var currentIndex = -1;
    var currentType = null; // "mole" or "bad" or null
    var score = 0;
    var timeLeft = GAME_TIME;
    var combo = 0;
    var miss = 0;
    var gameInterval = null;
    var moleIntervalId = null;
    var isRunning = false;

    function createGrid() {
      grid.innerHTML = "";
      holes = [];
      for (var i = 0; i < 9; i++) {
        var hole = document.createElement("div");
        hole.className = "hole";
        hole.dataset.index = i;

        hole.addEventListener("click", onHoleClick);
        hole.addEventListener("touchstart", function(e) {
          e.preventDefault();
          onHoleClick.call(this, e);
        }, { passive: false });

        grid.appendChild(hole);
        holes.push(hole);
      }
    }

    function clearCurrent() {
      if (currentIndex >= 0) {
        var hole = holes[currentIndex];
        hole.innerHTML = "";
      }
      currentIndex = -1;
      currentType = null;
    }

    function showRandomTarget() {
      clearCurrent();
      var idx = Math.floor(Math.random() * holes.length);
      currentIndex = idx;

      var hole = holes[idx];
      var content = document.createElement("div");
      content.className = "hole-content";

      // ä¸€å®šç¢ºç‡ã§ã€Œå©ã„ã¦ã¯ã„ã‘ãªã„ã‚­ãƒ£ãƒ©ã€ã‚’å‡ºã™
      if (Math.random() < currentDifficulty.badRate) {
        currentType = "bad";
        var img = document.createElement("img");
        img.src = "dont_hit.png";   // åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ç½®ã„ãŸç”»åƒ
        img.alt = "ãŸãŸã„ã¦ã¯ã„ã‘ãªã„ã‚­ãƒ£ãƒ©";
        img.className = "dont-hit-img";
        content.appendChild(img);
      } else {
        currentType = "mole";
        var body = document.createElement("div");
        body.className = "mole-body";
        var face = document.createElement("div");
        face.className = "mole-face";
        var eyeL = document.createElement("div");
        eyeL.className = "mole-eye left";
        var eyeR = document.createElement("div");
        eyeR.className = "mole-eye right";
        var mouth = document.createElement("div");
        mouth.className = "mole-mouth";

        face.appendChild(eyeL);
        face.appendChild(eyeR);
        face.appendChild(mouth);
        body.appendChild(face);
        content.appendChild(body);
      }

      hole.appendChild(content);
    }

    function onHoleClick(e) {
      if (!isRunning) return;
      initAudio();
      ensureAudioRunning();

      var idx = parseInt(this.dataset.index, 10);
      if (idx !== currentIndex || !currentType) {
        // ä½•ã‚‚ã„ãªã„å ´æ‰€ã‚’ãŸãŸã„ãŸ â†’ ãƒŸã‚¹
        miss++;
        combo = 0;
        missSpan.textContent = miss;
        comboSpan.textContent = combo;
        message.textContent = "ã¯ãšã‚Œâ€¦";
        playMissSound();
        return;
      }

      if (currentType === "mole") {
        score++;
        combo++;
        scoreSpan.textContent = score;
        comboSpan.textContent = combo;
        message.textContent = "ãƒŠã‚¤ã‚¹ãƒ’ãƒƒãƒˆï¼";
        playHitSound();
      } else if (currentType === "bad") {
        // ã‚ãŒã­ãŠã˜ã•ã‚“ï¼šãƒšãƒŠãƒ«ãƒ†ã‚£ âˆ’5ç‚¹ & å¤§ããªéŸ³
        score -= 5;
        miss++;
        combo = 0;
        scoreSpan.textContent = score;
        missSpan.textContent = miss;
        comboSpan.textContent = combo;
        message.textContent = "ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼ -5ç‚¹â€¦ ã‚ãŒã­ã®ãŠã˜ã•ã‚“ã§ã—ãŸã€‚";
        playPenaltySound();
      }

      clearCurrent();
    }

    function startGame() {
      if (isRunning) return;
      initAudio();
      ensureAudioRunning();

      // é›£æ˜“åº¦åæ˜ 
      currentDifficulty = DIFFICULTIES[difficultySelect.value];

      isRunning = true;
      score = 0;
      timeLeft = GAME_TIME;
      combo = 0;
      miss = 0;
      scoreSpan.textContent = score;
      timeLeftSpan.textContent = timeLeft;
      comboSpan.textContent = combo;
      missSpan.textContent = miss;
      message.textContent = "ãŒã‚“ã°ã£ã¦ï¼";

      gameInterval = setInterval(function() {
        timeLeft--;
        timeLeftSpan.textContent = timeLeft;
        if (timeLeft <= 0) {
          endGame();
        }
      }, 1000);

      moleIntervalId = setInterval(showRandomTarget, currentDifficulty.moleInterval);
      showRandomTarget();
    }

    function endGame() {
      if (!isRunning) return;
      isRunning = false;
      clearInterval(gameInterval);
      clearInterval(moleIntervalId);
      gameInterval = null;
      moleIntervalId = null;
      clearCurrent();

      message.textContent = "ã‚²ãƒ¼ãƒ çµ‚äº†ï¼ ã‚¹ã‚³ã‚¢ï¼š" + score +
        " ï¼ ãƒŸã‚¹ï¼š" + miss + " ï¼ æœ€å¤§ã‚³ãƒ³ãƒœï¼š" + combo;
      playGameOverSound();
    }

    function resetGame() {
      isRunning = false;
      clearInterval(gameInterval);
      clearInterval(moleIntervalId);
      gameInterval = null;
      moleIntervalId = null;

      clearCurrent();
      score = 0;
      timeLeft = GAME_TIME;
      combo = 0;
      miss = 0;
      scoreSpan.textContent = score;
      timeLeftSpan.textContent = timeLeft;
      comboSpan.textContent = combo;
      missSpan.textContent = miss;
      message.textContent = "";
    }

    startButton.onclick = startGame;
    resetButton.onclick = resetGame;

    difficultySelect.onchange = function() {
      // ã‚²ãƒ¼ãƒ ä¸­ã«å¤‰ãˆã¦ã‚‚ã€æ¬¡ã®ã‚¹ã‚¿ãƒ¼ãƒˆã‹ã‚‰åæ˜ 
      currentDifficulty = DIFFICULTIES[difficultySelect.value];
    };

    // åˆæœŸåŒ–
    createGrid();
    resetGame();
  </script>
</body>
</html>
