<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>æ•°å½“ã¦ã‚²ãƒ¼ãƒ </title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .container {
      background: #fff;
      padding: 26px;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.25);
      width: 420px;
    }

    h1 {
      text-align: center;
      margin-top: 0;
      color: #1e3c72;
    }

    .input-row {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 12px;
    }

    input[type="number"] {
      width: 120px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      text-align: center;
    }

    button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
    }

    #guessButton {
      background: #2a5298;
      color: #fff;
    }

    #resetButton {
      background: #e5e7eb;
    }

    #resetButton:disabled {
      opacity: 0.4;
    }

    .status {
      text-align: center;
      margin-top: 10px;
      min-height: 2.4em;
    }

    #historyList {
      list-style: none;
      background: #f9fafb;
      padding: 0;
      margin-top: 10px;
      border-radius: 8px;
      max-height: 120px;
      overflow-y: auto;
      border: 1px solid #e5e7eb;
    }

    #historyList li {
      padding: 4px 10px;
      border-bottom: 1px solid #e5e7eb;
      font-family: monospace;
    }

    #historyList li:last-child {
      border-bottom: none;
    }

    /* ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³ */
    #muteButton {
      background: #ffe9a8;
      border: 1px solid #e2c46e;
      margin-top: 10px;
      width: 100%;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>æ•°å½“ã¦ã‚²ãƒ¼ãƒ </h1>

    <p style="text-align:center; margin-top:-5px;">
      1ã€œ100ã®æ•°å­—ã‚’å½“ã¦ã‚ˆã†ï¼<br>
      ãƒãƒ£ãƒ³ã‚¹ã¯ 7 å›ã€‚
    </p>

    <div class="input-row">
      <input type="number" id="guessInput" min="1" max="100" placeholder="1ã€œ100" />
      <button id="guessButton">æ±ºå®šï¼</button>
      <button id="resetButton" disabled>ã‚‚ã†ä¸€å›</button>
    </div>

    <div class="status">
      <div id="message"></div>
      <div id="tries"></div>
    </div>

    <div class="history">
      <p><b>å…¥åŠ›å±¥æ­´</b></p>
      <ul id="historyList"></ul>
    </div>

    <button id="muteButton">ğŸ”Š BGM ON/OFF</button>
  </div>

  <script>
    //=================================================
    //  â–¼ BGMï¼ˆWeb Audio API ã®ãƒ«ãƒ¼ãƒ—éŸ³ï¼‰
    //=================================================
    let audioCtx = null;
    let bgmOsc = null;
    let bgmGain = null;
    let bgmEnabled = false;

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function startBGM() {
      if (!audioCtx) return;
      if (bgmEnabled) return;

      bgmOsc = audioCtx.createOscillator();
      bgmGain = audioCtx.createGain();

      bgmOsc.type = "triangle";

      // â™ª ãƒ”ã‚³ãƒ”ã‚³æ„Ÿã‚’ä½œã‚‹ï¼ˆéŸ³ç¨‹ã‚’ä¸Šä¸‹ã«æºã‚‰ã™ï¼‰
      let now = audioCtx.currentTime;
      bgmOsc.frequency.setValueAtTime(220, now);
      bgmOsc.frequency.linearRampToValueAtTime(260, now + 1);
      bgmOsc.frequency.linearRampToValueAtTime(220, now + 2);

      bgmOsc.frequency.setValueAtTime(220, now + 2);
      bgmGain.gain.value = 0.08;

      bgmOsc.connect(bgmGain);
      bgmGain.connect(audioCtx.destination);

      bgmOsc.start();
      bgmEnabled = true;

      // è‡ªå‹•ãƒ«ãƒ¼ãƒ—
      setInterval(() => {
        if (bgmOsc) {
          let t = audioCtx.currentTime;
          bgmOsc.frequency.setValueAtTime(220, t);
          bgmOsc.frequency.linearRampToValueAtTime(260, t + 1);
          bgmOsc.frequency.linearRampToValueAtTime(220, t + 2);
        }
      }, 2000);
    }

    function stopBGM() {
      if (bgmOsc) {
        try {
          bgmOsc.stop();
        } catch {}
      }
      bgmOsc = null;
      bgmEnabled = false;
    }

    // ãƒŸãƒ¥ãƒ¼ãƒˆãƒœã‚¿ãƒ³
    document.getElementById("muteButton").addEventListener("click", () => {
      initAudio();
      if (bgmEnabled) stopBGM();
      else startBGM();
    });


    //=================================================
    //  â–¼ åŠ¹æœéŸ³ï¼ˆæˆåŠŸ / ãƒŸã‚¹ / ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼‰
    //=================================================
    function playBeep(freq=440, duration=150) {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = "sine";
      osc.frequency.value = freq;
      gain.gain.value = 0.2;

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start();
      setTimeout(() => osc.stop(), duration);
    }

    function playSuccess() {
      playBeep(880, 120);
      setTimeout(() => playBeep(1046, 150), 150);
    }

    function playMiss() {
      playBeep(440, 120);
    }

    function playGameOver() {
      playBeep(220, 400);
    }

    //=================================================
    //  â–¼ æ•°å½“ã¦ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
    //=================================================
    let answer;
    let maxTries = 7;
    let currentTry;
    let finished;
    let history = [];

    const input = document.getElementById("guessInput");
    const guessButton = document.getElementById("guessButton");
    const resetButton = document.getElementById("resetButton");
    const message = document.getElementById("message");
    const tries = document.getElementById("tries");
    const historyList = document.getElementById("historyList");

    function startNewGame() {
      initAudio();
      answer = Math.floor(Math.random() * 100) + 1;
      currentTry = 0;
      finished = false;
      history = [];

      message.textContent = "ã‚²ãƒ¼ãƒ é–‹å§‹ï¼æ•°å­—ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
      tries.textContent = `æ®‹ã‚Šãƒãƒ£ãƒ³ã‚¹: ${maxTries}`;
      historyList.innerHTML = "";
      resetButton.disabled = true;

      input.value = "";
      input.focus();
    }

    function updateHistory() {
      historyList.innerHTML = "";
      history.forEach((h, i) => {
        const li = document.createElement("li");
        li.textContent = `${i + 1} å›ç›®: ${h.guess}  ${h.arrow}`;
        historyList.appendChild(li);
      });
    }

    guessButton.addEventListener("click", () => {
      initAudio();

      if (finished) {
        message.textContent = "ã‚²ãƒ¼ãƒ ã¯çµ‚äº†ã—ã¦ã„ã¾ã™ã€‚ã€Œã‚‚ã†ä¸€å›ã€ã§å†ã‚¹ã‚¿ãƒ¼ãƒˆã€‚";
        return;
      }

      const value = Number(input.value);
      if (!value || value < 1 || value > 100) {
        message.textContent = "1ã€œ100 ã®æ•´æ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
        return;
      }

      currentTry++;

      let arrow = "";
      if (value === answer) {
        message.textContent = `ğŸ‰ æ­£è§£ï¼ æ­£è§£ã¯ ${answer} ğŸ‰`;
        tries.textContent = `ä½¿ã£ãŸå›æ•°: ${currentTry}`;
        finished = true;
        resetButton.disabled = false;
        arrow = "ğŸ‰";
        playSuccess();
      } else if (value < answer) {
        message.textContent = "â¬†ï¸ï¼ˆã‚‚ã£ã¨å¤§ãã„ï¼‰";
        arrow = "â¬†ï¸";
        playMiss();
      } else {
        message.textContent = "â¬‡ï¸ï¼ˆã‚‚ã£ã¨å°ã•ã„ï¼‰";
        arrow = "â¬‡ï¸";
        playMiss();
      }

      history.push({ guess: value, arrow });
      updateHistory();

      // ãƒãƒ£ãƒ³ã‚¹åˆ‡ã‚Œ
      const remain = maxTries - currentTry;
      if (!finished) {
        if (remain <= 0) {
          message.textContent = `âŒ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ æ­£è§£ã¯ ${answer}`;
          tries.textContent = "ãƒãƒ£ãƒ³ã‚¹ã¯ã‚‚ã†ã‚ã‚Šã¾ã›ã‚“";
          finished = true;
          resetButton.disabled = false;
          playGameOver();
        } else {
          tries.textContent = `æ®‹ã‚Šãƒãƒ£ãƒ³ã‚¹: ${remain}`;
        }
      }

      input.value = "";
      input.focus();
    });

    resetButton.addEventListener("click", startNewGame);
    input.addEventListener("keydown", e => {
      if (e.key === "Enter") guessButton.click();
    });

    window.onload = startNewGame;
  </script>
</body>
</html
